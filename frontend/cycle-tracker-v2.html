<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Collection Tracker - Interactive Mock-ups v2</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a1a;
      color: #e5e5e5;
      padding: 20px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .mockup-container {
      background: rgba(30, 30, 30, 0.95);
      border: 2px solid #444;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .mockup-label {
      background: #d97706;
      color: white;
      padding: 8px 12px;
      font-weight: bold;
      font-size: 12px;
      text-align: center;
    }

    .mockup-a {
      width: 300px;
      height: 650px;
    }

    .mockup-b {
      width: 320px;
      height: 650px;
    }

    .mockup-c {
      width: 280px;
      height: 650px;
    }

    .tracker {
      height: calc(100% - 32px);
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.9);
    }

    /* Header with timer */
    .header {
      background: rgba(40, 40, 40, 0.95);
      padding: 10px 12px;
      border-bottom: 1px solid #555;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .timer-container {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }

    .timer-label {
      font-size: 9px;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .timer-value {
      font-size: 14px;
      font-weight: bold;
      color: #fbbf24;
      font-variant-numeric: tabular-nums;
    }

    .close-btn {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 16px;
      padding: 0 4px;
    }

    .close-btn:hover {
      color: #fff;
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: rgba(50, 50, 50, 0.8);
      border-bottom: 1px solid #555;
    }

    .tab {
      flex: 1;
      padding: 8px;
      text-align: center;
      cursor: pointer;
      font-size: 12px;
      border: none;
      background: none;
      color: #999;
      transition: all 0.2s;
    }

    .tab.active {
      background: rgba(217, 119, 6, 0.3);
      color: #fbbf24;
      border-bottom: 2px solid #fbbf24;
    }

    .tab:hover {
      background: rgba(217, 119, 6, 0.2);
      color: #fbbf24;
    }

    /* Content area */
    .content {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .content::-webkit-scrollbar {
      width: 6px;
    }

    .content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
    }

    .content::-webkit-scrollbar-thumb {
      background: rgba(217, 119, 6, 0.5);
      border-radius: 3px;
    }

    /* Set items */
    .set-item {
      margin-bottom: 4px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding-bottom: 4px;
    }

    .set-header {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s;
      user-select: none;
    }

    .set-header:hover {
      background: rgba(217, 119, 6, 0.1);
    }

    .expand-icon {
      font-size: 10px;
      width: 12px;
      color: #999;
    }

    .set-emoji {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    .set-progress {
      color: #9ca3af;
      min-width: 40px;
      font-size: 11px;
    }

    .set-name {
      flex: 1;
      font-size: 12px;
    }

    .set-name.complete {
      color: #10b981;
    }

    .eye-icon {
      cursor: pointer;
      font-size: 14px;
      padding: 2px;
      transition: all 0.2s;
    }

    .eye-icon.visible {
      color: #fbbf24;
    }

    .eye-icon.hidden {
      color: #6b7280;
      opacity: 0.5;
    }

    .eye-icon:hover {
      transform: scale(1.2);
    }

    /* Expanded items list - COMPACT 2-COLUMN LAYOUT */
    .items-list {
      display: none;
      padding: 4px 0 4px 24px;
      font-size: 11px;
    }

    .items-list.expanded {
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
    }

    .item-compact {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      width: calc(50% - 2px);
      padding: 2px 4px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 10px;
    }

    .item-compact:hover {
      background: rgba(217, 119, 6, 0.1);
    }

    .item-checkbox {
      width: 12px;
      color: #9ca3af;
      flex-shrink: 0;
    }

    .item-checkbox.collected {
      color: #10b981;
    }

    .item-name {
      flex: 1;
      color: #d1d5db;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .item-name.collected {
      color: #6b7280;
      text-decoration: line-through;
    }

    /* Random categories */
    .random-category {
      margin-bottom: 6px;
      padding: 6px 4px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .random-header {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .random-header:hover {
      background: rgba(217, 119, 6, 0.1);
    }

    .random-details {
      display: none;
      padding: 6px 0 0 24px;
      font-size: 10px;
      color: #9ca3af;
    }

    .random-details.expanded {
      display: block;
    }

    .show-spawns-btn {
      margin-top: 4px;
      padding: 4px 8px;
      background: rgba(217, 119, 6, 0.2);
      border: 1px solid rgba(217, 119, 6, 0.5);
      border-radius: 3px;
      color: #fbbf24;
      cursor: pointer;
      font-size: 10px;
      transition: all 0.2s;
      width: 100%;
    }

    .show-spawns-btn:hover {
      background: rgba(217, 119, 6, 0.4);
    }

    /* Footer */
    .footer {
      background: rgba(40, 40, 40, 0.95);
      padding: 8px 12px;
      border-top: 1px solid #555;
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
    }

    /* Loading state */
    .loading {
      padding: 20px;
      text-align: center;
      color: #9ca3af;
      font-size: 12px;
    }

    /* Info banner */
    .info-banner {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.5);
      padding: 8px;
      margin: 10px;
      border-radius: 4px;
      font-size: 11px;
      color: #93c5fd;
      text-align: center;
    }

    /* Variant-specific adjustments */

    /* Variant A: Timer in header title area */
    .mockup-a .header {
      flex-direction: column;
      align-items: stretch;
      gap: 6px;
      padding: 8px 12px;
    }

    .mockup-a .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .mockup-a .timer-container {
      flex-direction: row;
      gap: 6px;
      align-items: center;
    }

    /* Variant B: Compact timer inline */
    .mockup-b .timer-container {
      flex-direction: row;
      gap: 4px;
      align-items: baseline;
    }

    .mockup-b .timer-label {
      font-size: 10px;
    }

    .mockup-b .timer-value {
      font-size: 13px;
    }

    /* Variant C: Ultra compact */
    .mockup-c .set-header {
      padding: 4px 2px;
      gap: 3px;
    }

    .mockup-c .set-emoji {
      font-size: 14px;
      width: 16px;
    }

    .mockup-c .set-progress {
      min-width: 35px;
      font-size: 10px;
    }

    .mockup-c .set-name {
      font-size: 11px;
    }

    .mockup-c .items-list {
      padding-left: 20px;
    }
  </style>
</head>
<body>

  <!-- Mock-up A: Timer Above -->
  <div class="mockup-container mockup-a">
    <div class="mockup-label">Variant A: Timer Above Close Button</div>
    <div class="tracker" id="tracker-a">
      <div class="header">
        <div class="header-row">
          <div class="timer-container">
            <span class="timer-label">Next cycle:</span>
            <span class="timer-value" id="timer-a">00:00:00</span>
          </div>
          <button class="close-btn">×</button>
        </div>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="guaranteed" data-tracker="a">Sets</button>
        <button class="tab" data-tab="random" data-tracker="a">Random</button>
      </div>
      <div class="content" id="content-a">
        <div class="loading">Loading cycle data...</div>
      </div>
      <div class="footer" id="footer-a">Loading...</div>
    </div>
  </div>

  <!-- Mock-up B: Timer Left Side -->
  <div class="mockup-container mockup-b">
    <div class="mockup-label">Variant B: Timer Left, Close Right</div>
    <div class="tracker" id="tracker-b">
      <div class="header">
        <div class="timer-container">
          <span class="timer-label">Next:</span>
          <span class="timer-value" id="timer-b">00:00:00</span>
        </div>
        <button class="close-btn">×</button>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="guaranteed" data-tracker="b">Sets</button>
        <button class="tab" data-tab="random" data-tracker="b">Random</button>
      </div>
      <div class="content" id="content-b">
        <div class="loading">Loading cycle data...</div>
      </div>
      <div class="footer" id="footer-b">Loading...</div>
    </div>
  </div>

  <!-- Mock-up C: Ultra Compact -->
  <div class="mockup-container mockup-c">
    <div class="mockup-label">Variant C: Ultra Compact (280px)</div>
    <div class="tracker" id="tracker-c">
      <div class="header">
        <div class="timer-container">
          <span class="timer-label">Next:</span>
          <span class="timer-value" id="timer-c">00:00:00</span>
        </div>
        <button class="close-btn">×</button>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="guaranteed" data-tracker="c">Sets</button>
        <button class="tab" data-tab="random" data-tracker="c">Random</button>
      </div>
      <div class="content" id="content-c">
        <div class="loading">Loading cycle data...</div>
      </div>
      <div class="footer" id="footer-c">Loading...</div>
    </div>
  </div>

  <div class="info-banner" style="position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); width: 700px;">
    <strong>Real Data from Today's Cycle</strong> • Click sets to expand • Click items to toggle collected • Click 👁️ to toggle map visibility • Random items show as #0, #1, #2, etc.
  </div>

  <script>
    // Global state
    const state = {
      expandedSets: {},
      visibilityMap: {},
      collectedItems: {},
      cycleData: null,
      itemsData: null
    };

    // Countdown timer to 00:00 UTC
    function updateTimers() {
      const now = new Date();
      const utcNow = new Date(now.getTime() + now.getTimezoneOffset() * 60000);

      const tomorrow = new Date(utcNow);
      tomorrow.setUTCHours(24, 0, 0, 0);

      const diff = tomorrow - utcNow;

      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

      document.getElementById('timer-a').textContent = timeString;
      document.getElementById('timer-b').textContent = timeString;
      document.getElementById('timer-c').textContent = timeString;
    }

    // Load real data from Joan Ropke API
    async function loadRealData() {
      try {
        // Fetch cycles and items data
        const [cyclesResponse, itemsResponse] = await Promise.all([
          fetch('https://jeanropke.github.io/RDR2CollectorsMap/data/cycles.json'),
          fetch('https://jeanropke.github.io/RDR2CollectorsMap/data/items.json')
        ]);

        const cyclesData = await cyclesResponse.json();
        const itemsData = await itemsResponse.json();

        // Get today's date in UTC
        const now = new Date();
        const utcNow = new Date(now.getTime() + now.getTimezoneOffset() * 60000);
        const today = utcNow.toISOString().split('T')[0];

        // Find today's cycles
        const todayCycles = cyclesData.find(entry => entry.date === today);

        if (!todayCycles) {
          console.error('No cycle data for today:', today);
          return null;
        }

        state.cycleData = todayCycles;
        state.itemsData = itemsData;

        return { cycles: todayCycles, items: itemsData };
      } catch (error) {
        console.error('Failed to load real data:', error);
        return null;
      }
    }

    // Smart name shortening
    function shortenItemName(rawName, category) {
      let name = rawName;

      // Remove common prefixes
      name = name
        .replace(/^(document_card_|provision_|consumable_)/, '')
        .replace(/^(hrlm_|egg_)/, '');

      // Handle random items (e.g., "arrowhead_random_5" -> "#5")
      if (name.includes('_random_')) {
        const match = name.match(/_random_(\d+)/);
        if (match) {
          return `#${match[1]}`;
        }
      }

      // Handle tarot cards - remove suit name since it's in the set title
      if (['cups', 'swords', 'wands', 'pentacles'].includes(category)) {
        name = name.replace(/_(cups|swords|wands|pentacles)$/, '');
      }

      // Handle eggs - remove "egg" suffix
      if (category === 'egg') {
        name = name.replace(/_egg(_\d+)?$/, '');
      }

      // Handle flowers - remove common patterns
      if (category === 'flower') {
        name = name
          .replace(/^(american_wild_flower_|wild_flower_)/, '')
          .replace(/_(flower|blossom)$/, '');
      }

      // Handle heirlooms - shorten common patterns
      if (category === 'heirlooms') {
        name = name
          .replace(/^(brush_|comb_|hairpin_)/, '')
          .replace(/_brush$/, ' Br.')
          .replace(/_comb$/, ' Cb.')
          .replace(/_hairpin$/, ' Pin');
      }

      // Convert to readable format
      name = name
        .replace(/_/g, ' ')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');

      return name;
    }

    // Parse real data into organized sets
    function parseRealData() {
      if (!state.cycleData || !state.itemsData) return null;

      const sets = [];
      const randomCategories = [];

      // Category configuration
      const categoryConfig = {
        // Guaranteed sets (tarot cards)
        'cups': { emoji: '🏆', name: 'Cups', type: 'guaranteed' },
        'swords': { emoji: '🎴', name: 'Swords', type: 'guaranteed' },
        'wands': { emoji: '⭐', name: 'Wands', type: 'guaranteed' },
        'pentacles': { emoji: '🃏', name: 'Pentacles', type: 'guaranteed' },

        // Guaranteed sets (eggs)
        'egg': { emoji: '🥚', name: 'Eggs', type: 'guaranteed' },

        // Guaranteed sets (others)
        'bottle': { emoji: '🍾', name: 'Bottles', type: 'guaranteed' },
        'flower': { emoji: '🌺', name: 'Flowers', type: 'guaranteed' },
        'heirlooms': { emoji: '👑', name: 'Heirlooms', type: 'guaranteed' },

        // Random categories
        'arrowhead': { emoji: '🎯', name: 'Arrowheads', type: 'random' },
        'coin': { emoji: '🪙', name: 'Coins', type: 'random' },
        'fossils': { emoji: '🦴', name: 'Fossils', type: 'random' },
        'jewelry': { emoji: '💍', name: 'Jewelry', type: 'random' }
      };

      // Process each category
      for (const [category, config] of Object.entries(categoryConfig)) {
        const cycleNum = state.cycleData[category];
        if (!cycleNum) continue;

        const categoryItems = state.itemsData[category];
        if (!categoryItems) continue;

        const cycleItems = categoryItems[String(cycleNum)];
        if (!cycleItems || !Array.isArray(cycleItems)) continue;

        // Check if this is a random category
        const isRandom = cycleItems.some(item => item.text && item.text.includes('_random_'));

        const items = cycleItems.map((item, index) => {
          const rawName = item.text || 'Unknown';
          const readableName = shortenItemName(rawName, category);

          return {
            id: rawName,
            name: readableName,
            collected: false
          };
        });

        if (isRandom || config.type === 'random') {
          // Random category with individual items
          randomCategories.push({
            emoji: config.emoji,
            name: config.name,
            category: category,
            total: items.length,
            collected: 0,
            visible: true,
            items: items  // Now includes individual items
          });
        } else {
          // Guaranteed set
          sets.push({
            emoji: config.emoji,
            name: config.name,
            category: category,
            total: items.length,
            collected: 0,
            visible: true,
            items: items
          });
        }
      }

      return { sets, randomCategories };
    }

    // Toggle functions
    function toggleSet(setName) {
      state.expandedSets[setName] = !state.expandedSets[setName];
      renderAll();
    }

    function toggleVisibility(setName) {
      state.visibilityMap[setName] = !state.visibilityMap[setName];
      renderAll();
    }

    function toggleCollected(setName, itemId) {
      const key = `${setName}-${itemId}`;
      state.collectedItems[key] = !state.collectedItems[key];
      renderAll();
    }

    // Render guaranteed sets
    function renderGuaranteedSets(data) {
      if (!data || !data.sets) return '<div class="loading">No data available</div>';

      return data.sets.map(set => {
        const isExpanded = state.expandedSets[set.name];
        const isVisible = state.visibilityMap[set.name] !== false;
        const expandIcon = isExpanded ? '▼' : '▽';

        // Count collected items
        let collectedCount = 0;
        set.items.forEach(item => {
          const key = `${set.name}-${item.id}`;
          if (state.collectedItems[key]) collectedCount++;
        });

        const isComplete = collectedCount === set.total;

        let itemsHTML = '';
        if (isExpanded) {
          itemsHTML = `
            <div class="items-list expanded">
              ${set.items.map(item => {
                const key = `${set.name}-${item.id}`;
                const isCollected = state.collectedItems[key];

                return `
                  <div class="item-compact" onclick="toggleCollected('${set.name}', '${item.id}')">
                    <span class="item-checkbox ${isCollected ? 'collected' : ''}">
                      ${isCollected ? '✓' : '○'}
                    </span>
                    <span class="item-name ${isCollected ? 'collected' : ''}" title="${item.name}">
                      ${item.name}
                    </span>
                  </div>
                `;
              }).join('')}
            </div>
          `;
        }

        return `
          <div class="set-item">
            <div class="set-header" onclick="toggleSet('${set.name}')">
              <span class="expand-icon">${expandIcon}</span>
              <span class="set-emoji">${set.emoji}</span>
              <span class="set-progress">${collectedCount}/${set.total}</span>
              <span class="set-name ${isComplete ? 'complete' : ''}">${set.name}</span>
              <span class="eye-icon ${isVisible ? 'visible' : 'hidden'}" onclick="event.stopPropagation(); toggleVisibility('${set.name}')">
                ${isVisible ? '👁️' : '👁️‍🗨️'}
              </span>
            </div>
            ${itemsHTML}
          </div>
        `;
      }).join('');
    }

    // Render random categories
    function renderRandomCategories(data) {
      if (!data || !data.randomCategories) return '<div class="loading">No data available</div>';

      return data.randomCategories.map(cat => {
        const isExpanded = state.expandedSets[cat.name];
        const isVisible = state.visibilityMap[cat.name] !== false;
        const expandIcon = isExpanded ? '▼' : '▽';

        // Count collected items
        let collectedCount = 0;
        cat.items.forEach(item => {
          const key = `${cat.name}-${item.id}`;
          if (state.collectedItems[key]) collectedCount++;
        });

        let itemsHTML = '';
        if (isExpanded) {
          itemsHTML = `
            <div class="items-list expanded">
              ${cat.items.map(item => {
                const key = `${cat.name}-${item.id}`;
                const isCollected = state.collectedItems[key];

                return `
                  <div class="item-compact" onclick="toggleCollected('${cat.name}', '${item.id}')">
                    <span class="item-checkbox ${isCollected ? 'collected' : ''}">
                      ${isCollected ? '✓' : '○'}
                    </span>
                    <span class="item-name ${isCollected ? 'collected' : ''}" title="${item.name}">
                      ${item.name}
                    </span>
                  </div>
                `;
              }).join('')}
            </div>
          `;
        }

        return `
          <div class="set-item">
            <div class="set-header" onclick="toggleSet('${cat.name}')">
              <span class="expand-icon">${expandIcon}</span>
              <span class="set-emoji">${cat.emoji}</span>
              <span class="set-progress">${collectedCount}/${cat.total}</span>
              <span class="set-name">${cat.name}</span>
              <span class="eye-icon ${isVisible ? 'visible' : 'hidden'}" onclick="event.stopPropagation(); toggleVisibility('${cat.name}')">
                ${isVisible ? '👁️' : '👁️‍🗨️'}
              </span>
            </div>
            ${itemsHTML}
          </div>
        `;
      }).join('');
    }

    // Render all mockups
    function renderAll() {
      const data = parseRealData();
      if (!data) return;

      const guaranteedHTML = renderGuaranteedSets(data);
      const randomHTML = renderRandomCategories(data);

      // Update all mockups
      ['a', 'b', 'c'].forEach(id => {
        const content = document.getElementById(`content-${id}`);
        const activeTab = document.querySelector(`#tracker-${id} .tab.active`);
        const tabType = activeTab?.dataset.tab || 'guaranteed';

        if (tabType === 'guaranteed') {
          content.innerHTML = guaranteedHTML;
        } else if (tabType === 'random') {
          content.innerHTML = randomHTML;
        }

        // Update footer - include both guaranteed and random
        const totalItems = data.sets.reduce((sum, set) => sum + set.total, 0) +
                          data.randomCategories.reduce((sum, cat) => sum + cat.total, 0);
        let totalCollected = 0;

        // Count guaranteed
        data.sets.forEach(set => {
          set.items.forEach(item => {
            const key = `${set.name}-${item.id}`;
            if (state.collectedItems[key]) totalCollected++;
          });
        });

        // Count random
        data.randomCategories.forEach(cat => {
          cat.items.forEach(item => {
            const key = `${cat.name}-${item.id}`;
            if (state.collectedItems[key]) totalCollected++;
          });
        });

        document.getElementById(`footer-${id}`).textContent =
          `${totalCollected}/${totalItems} collected (${Math.round(totalCollected/totalItems*100)}%)`;
      });
    }

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const trackerId = this.dataset.tracker;
        const parent = document.getElementById(`tracker-${trackerId}`);

        parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        renderAll();
      });
    });

    // Initialize
    async function init() {
      // Start timer
      updateTimers();
      setInterval(updateTimers, 1000);

      // Load real data
      const result = await loadRealData();
      if (result) {
        renderAll();
      } else {
        // Fallback message
        document.querySelectorAll('.content').forEach(el => {
          el.innerHTML = '<div class="loading">Failed to load cycle data. Check console for errors.</div>';
        });
      }
    }

    init();
  </script>
</body>
</html>
